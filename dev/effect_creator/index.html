<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ability Creator</title>
    <link rel="icon" href="../../img/icons/w.png"/>
    <link rel="stylesheet" href="../../style.css"/>
</head>
<body>
<h1>Ability Effects Creator</h1>
<div style="display: flex;">
    <div style="width: 300px; padding: 1ch;">
        <h2>Import:</h2>
        <label for="load_from_file">Import from JSON string:</label>
        <br>
        <input type="file" id="load_from_file" accept=".json">
        <br>
        <br>
        <label for="abilities_tree_selector">Generate new from tree:</label>
        <br>
        <select id="abilities_tree_selector">
            <option value="archer">Archer</option>
            <option value="assassin">Assassin</option>
            <option value="mage">Mage</option>
            <option value="shaman">Shaman</option>
            <option value="warrior">Warrior</option>
        </select>
        <button id="generate_tree">Load</button>
        <br>
        <br>

        <h2>Export:</h2>
        <button id="save_text">Save effects to file</button>
    </div>

    <div style="padding: 1ch;">
        <h2>Effect Editor:</h2>
        <div id="effect_editor" style="width: 350px;">
            <div class="warn" style="color: red;">No effect selected!</div>
            <div class="editor">
                <label>Effect name:</label>
                <input class="name_input" placeholder="Unnamed effect"/>
                <br>
                <label>Effect type:</label>
                <select class="effect_type">
                    <option value="">Nothing</option>
                    <option value="conv">Attack</option>
                    <option value="variant">Attack Variant</option>
                    <option value="mastery">Mastery</option>
                    <option value="heal">Healing</option>
                    <option value="team-multiplier">Team Damage Multiplier</option>
                    <option value="personal-multiplier">Personal Damage Multiplier</option>
                    <option value="resistance">Resistance Multiplier</option>
                    <option value="cost">Spell Cost</option>
                    <option value="cost-multiplier">Spell Cost Multiplier</option>
                </select>
                <br>
                <label>Parent requirement:</label>
                <select class="requires_all_parents">
                    <option value="true">All Parents</option>
                    <option value="false">Any Parents</option>
                </select>
                <br>
                <label>Parents:</label>
                <button class="parents_show" data-show="false"></button>
                <div class="parent_toggles" style="display: none;"></div>
                <br>
                <label>Effect Blocks:</label>
                <button class="blocks_show" data-show="false"></button>
                <div class="block_toggles" style="display: none;"></div>
                <h3>Effect-specific settings:</h3>
                <div class="effect-specific"></div>
            </div>
        </div>
    </div>
</div>
<div style="display: flex;">
    <div style="padding: 1ch;">
        <h2>Abilities:</h2>
        <div id="ability_holder" style="width: 34ch"></div>
    </div>

    <div style="padding: 1ch;">
        <h2>Effects:</h2>
        <div id="effect_holder" style="width: 300px"></div>
    </div>
</div>

<script src="../../src/data/trees.js"></script>
<script src="../../src/data_manipulation/minecraft_html.js"></script>
<script src="../../src/data/code_dictionary.js"></script>
<script src="../../src/control/tooltip.js"></script>

<script src="../../src/control/effect_builder.js"></script>

<script>
    let editor = new Editor(null);
    let tree = new Tree("archer", editor);

    document.getElementById("generate_tree").addEventListener("click", () => {
        const treeName = document.getElementById("abilities_tree_selector").value;
        loadNewFromClass(treeName);
    });

    document.getElementById("load_from_file").addEventListener("change", (e) => {
        const file = e.target.files[0];
        const reader = new FileReader();

        reader.onload = function (e) {
            const content = e.target.result;
            tree.changeTree(JSON.parse(String(content)));
        };

        reader.readAsText(file);


        e.target.value = null;
    });

    document.getElementById("save_text").addEventListener("click", () => {
        const content = JSON.stringify(tree);
        let a = document.createElement("a");
        let file = new Blob([content], {type: "text/plain"});
        a.href = URL.createObjectURL(file);
        a.download = tree.wynnClass + "_effects.json";
        a.click();
        URL.revokeObjectURL(a.href);
    });

    function loadNewFromClass(wynn_class) {
        tree = new Tree(wynn_class, editor);
    }

    addTooltipListener();
</script>
</body>
</html>